<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tusmatch - Jeu</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Styles spÃ©cifiques au multijoueur */
        #lobby-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px;
        }
        .lobby-box {
            background: var(--tile-bg); padding: 30px; border-radius: 10px;
            text-align: center; max-width: 400px; width: 100%;
            border: 1px solid var(--tile-border);
        }
        .lobby-btn {
            display: block; width: 100%; padding: 12px; margin: 10px 0;
            background: var(--key-bg); color: var(--text-color);
            border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
            font-size: 1rem;
        }
        .lobby-btn:hover { opacity: 0.9; }
        .lobby-input {
            width: 100%; padding: 12px; margin: 10px 0;
            background: var(--bg-color); border: 1px solid var(--tile-border);
            color: var(--text-color); border-radius: 5px; font-size: 1rem;
            text-transform: uppercase; text-align: center;
        }
        #opponents-container {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .opponent-card {
            background: var(--tile-bg); padding: 10px; border-radius: 8px;
            border: 1px solid var(--tile-border); width: 160px;
        }
        .opponent-name { font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; text-align: center; }
        .mini-grid { display: grid; gap: 2px; }
        .mini-row { display: grid; grid-template-columns: repeat(var(--mini-cols, 5), 1fr); gap: 2px; height: 15px; }
        .mini-tile { 
            width: 100%; height: 100%; 
            background: var(--tile-bg); 
            border: 1px solid var(--tile-border); /* Ajout bordure pour visibilitÃ© */
            border-radius: 2px; 
        }
        .mini-tile.correct { background: var(--correct); border-color: var(--correct); }
        .mini-tile.present { background: var(--present); border-color: var(--present); }
        .mini-tile.absent { background: var(--absent); border-color: var(--absent); }
        .mini-tile.filled { background: var(--filled-tile); border-color: var(--filled-tile); }
        .typing-indicator { font-size: 0.7rem; color: var(--active-border); height: 1rem; text-align: center; }
        
        .hidden { display: none !important; }
        
        /* SÃ©parateur Lobby */
        .lobby-separator {
            width: 100%; height: 1px; background: var(--tile-border);
            margin: 20px 0; opacity: 0.5;
        }
        .lobby-section-title {
            font-size: 0.9rem; font-weight: bold; margin-bottom: 10px; 
            text-align: left; width: 100%; opacity: 0.8;
        }

        /* In-Game Room Info */
        #room-info-bar {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; align-items: center;
            background: var(--tile-bg); padding: 5px 15px; border-radius: 20px;
            border: 1px solid var(--tile-border);
            z-index: 50;
        }
        .room-code-display { font-weight: bold; letter-spacing: 2px; margin-right: 10px; }
        .icon-btn {
            background: none; border: none; cursor: pointer; color: var(--text-color);
            padding: 5px; border-radius: 5px; display: flex; align-items: center;
        }
        .icon-btn:hover { background: var(--tile-border); }
        
        /* Avatar & Crown */
        .player-header { display: flex; align-items: center; justify-content: center; gap: 5px; margin-bottom: 5px; }
        .avatar-icon { width: 20px; height: 20px; fill: var(--text-color); }
        .crown-icon { font-size: 1rem; }

        /* Custom Modal */
        .custom-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 200;
            display: flex; align-items: center; justify-content: center;
        }
        .custom-modal-box {
            background: var(--bg-color); padding: 25px; border-radius: 10px;
            border: 1px solid var(--tile-border); text-align: center;
            max-width: 300px; width: 90%; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        .modal-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn-confirm { background: var(--correct); color: white; padding: 8px 16px; border-radius: 5px; }
        .btn-cancel { background: var(--absent); color: white; padding: 8px 16px; border-radius: 5px; }

    </style>
</head>
<body>
    <!-- Custom Leave Modal -->
    <div id="leave-modal" class="custom-modal-overlay hidden">
        <div class="custom-modal-box">
            <h3>Quitter la partie ?</h3>
            <p style="margin-top: 10px; opacity: 0.8;">Tu ne pourras perdra cette manche si elle est en cours.</p>
            <div class="modal-actions">
                <button id="confirm-leave" class="btn-confirm">Quitter</button>
                <button id="cancel-leave" class="btn-cancel">Annuler</button>
            </div>
        </div>
    </div>

    <!-- In-Game Room Info (Private Only) - REMOVED, MOVED TO SIDEBAR -->
    <!-- <div id="room-info-bar" class="hidden"> ... </div> -->

    <!-- LOBBY MULTIJOUEUR -->
    <div id="lobby-overlay" class="hidden">
        <div class="lobby-box" id="lobby-start">
            <h2>Match PrivÃ©</h2>
            <p style="margin-bottom: 20px; opacity: 0.7;">CrÃ©e une salle ou rejoins tes amis</p>
            
            <div style="width: 100%; margin-bottom: 10px;">
                <label for="player-pseudo" class="lobby-section-title">Ton Pseudo</label>
                <input type="text" id="player-pseudo" class="lobby-input" placeholder="Choisis un pseudo..." maxlength="12">
            </div>

            <div class="lobby-separator"></div>

            <div style="width: 100%;">
                <div class="lobby-section-title">CrÃ©er une partie</div>
                <button id="btn-create-game" class="lobby-btn">Nouvelle Salle</button>
            </div>

            <div style="margin: 15px 0; font-size: 0.8rem; opacity: 0.5;">â€” OU â€”</div>

            <div style="width: 100%;">
                <div class="lobby-section-title">Rejoindre une partie</div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="lobby-code-input" class="lobby-input" style="margin: 0; flex: 1;" placeholder="Code (ex: ABCDE)" maxlength="5">
                    <button id="btn-join-game" class="lobby-btn" style="margin: 0; width: auto; min-width: 100px;">Go</button>
                </div>
            </div>
        </div>

        <div class="lobby-box hidden" id="lobby-waiting">
            <h2>Salle d'attente</h2>
            <div style="font-size: 2rem; letter-spacing: 5px; margin: 20px 0; font-weight: bold;" id="display-room-code">----</div>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
                <button id="btn-share-link" class="lobby-btn" style="background: var(--present); font-size: 0.9rem; flex: 2;">ðŸ”— Lien</button>
                <button id="btn-copy-code" class="lobby-btn" style="background: var(--key-bg); font-size: 0.9rem; flex: 1;">ðŸ“‹ Code</button>
            </div>

            <p>Partage ce code avec tes amis</p>
            <div id="players-list" style="margin: 20px 0; text-align: left;">
                <!-- Liste des joueurs -->
            </div>
            <button id="btn-start-game" class="lobby-btn hidden">Lancer la partie</button>
            <p id="waiting-message" class="hidden">En attente du chef de salle...</p>
        </div>
    </div>

    <button id="btn-leave-game" class="back-btn">Retour</button>
    <button id="themeToggle" class="theme-switch">ThÃ¨me</button>
    <button id="devModeBtn" style="position: absolute; bottom: 10px; right: 10px; opacity: 0.3; font-size: 10px;">Dev</button>
    
    <!-- In-Game Sidebar (Room Info + Players) -->
    <div id="ingame-sidebar" class="hidden">
        <div class="sidebar-header">
            <div class="room-code-box">
                <span style="font-size: 0.7rem; opacity: 0.7;">CODE</span>
                <span id="sidebar-room-code" style="font-weight: bold; letter-spacing: 2px;">----</span>
            </div>
            <div class="sidebar-actions">
                <button id="sidebar-share-link" class="icon-btn" title="Copier le lien">ðŸ”—</button>
                <button id="sidebar-copy-code" class="icon-btn" title="Copier le code">ðŸ“‹</button>
            </div>
        </div>
        <div id="ingame-players-content">
            <!-- Populated by JS -->
        </div>
    </div>

    <div class="game-container">
        <!-- Zone des adversaires -->
        <div id="opponents-container"></div>

        <div id="message-container"></div>

        <div class="grid" id="grid"></div>

        <div class="keyboard" id="keyboard">
            <div class="key-row">
                <button class="key" data-key="A">A</button>
                <button class="key" data-key="Z">Z</button>
                <button class="key" data-key="E">E</button>
                <button class="key" data-key="R">R</button>
                <button class="key" data-key="T">T</button>
                <button class="key" data-key="Y">Y</button>
                <button class="key" data-key="U">U</button>
                <button class="key" data-key="I">I</button>
                <button class="key" data-key="O">O</button>
                <button class="key" data-key="P">P</button>
            </div>
            <div class="key-row">
                <button class="key" data-key="Q">Q</button>
                <button class="key" data-key="S">S</button>
                <button class="key" data-key="D">D</button>
                <button class="key" data-key="F">F</button>
                <button class="key" data-key="G">G</button>
                <button class="key" data-key="H">H</button>
                <button class="key" data-key="J">J</button>
                <button class="key" data-key="K">K</button>
                <button class="key" data-key="L">L</button>
                <button class="key" data-key="M">M</button>
            </div>
            <div class="key-row">
                <button class="key large" data-key="Enter">EntrÃ©e</button>
                <button class="key" data-key="W">W</button>
                <button class="key" data-key="X">X</button>
                <button class="key" data-key="C">C</button>
                <button class="key" data-key="V">V</button>
                <button class="key" data-key="B">B</button>
                <button class="key" data-key="N">N</button>
                <button class="key large" data-key="Backspace">âŒ«</button>
            </div>
        </div>
    </div>

    <!-- End Game Modal -->
    <div id="endModal" class="modal hidden">
        <div class="modal-content">
            <h2 id="endTitle">Titre</h2>
            <p id="endMessage">Message</p>
            <div id="wordDisplay" class="word-reveal"></div>
            <div class="modal-actions">
                <button id="shareBtn" class="action-btn share">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    Partager
                </button>
                <button id="restartBtn" class="action-btn restart">Rejouer</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
    <script src="multiplayer.js"></script>
</body>
</html>