<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tusmatch - Jeu</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style_multiplayer.css">
    <link rel="stylesheet" href="style_toast.css">
    
    <!-- Preload Avatars -->
    <link rel="preload" as="image" href="assets/1.gif">
    <link rel="preload" as="image" href="assets/2.gif">
    <link rel="preload" as="image" href="assets/3.gif">
    <link rel="preload" as="image" href="assets/4.gif">
    <link rel="preload" as="image" href="assets/5.gif">
    <link rel="preload" as="image" href="assets/6.gif">
    <link rel="preload" as="image" href="assets/7.gif">
    <link rel="preload" as="image" href="assets/8.gif">
    <link rel="preload" as="image" href="assets/9.gif">
    <link rel="preload" as="image" href="assets/10.gif">
    <link rel="preload" as="image" href="assets/11.gif">
    <link rel="preload" as="image" href="assets/12.gif">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6243220405591714"
     crossorigin="anonymous"></script>

    <link rel="icon" type="image/png" href="/assets/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Tusmatch" />
    <link rel="manifest" href="/assets/site.webmanifest" />
</head>
<body>
    <button id="leaderboardBtn" class="leaderboard-btn" title="Classement">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
            <path d="M4 22h16"></path>
            <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
        </svg>
    </button>

    <!-- Custom Leave Modal -->
    <div id="leave-modal" class="custom-modal-overlay hidden">
        <div class="custom-modal-box">
            <h3>Quitter la partie ?</h3>
            <p style="margin-top: 10px; opacity: 0.8;">Tu perdras cette manche.</p>
            <div class="modal-actions">
                <button id="confirm-leave" class="btn-confirm">Quitter</button>
                <button id="cancel-leave" class="btn-cancel">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Generic Custom Alert Modal -->
    <div id="custom-alert-modal" class="custom-modal-overlay hidden" style="z-index: 2000;">
        <div class="custom-modal-box">
            <h3 id="custom-alert-title">Message</h3>
            <p id="custom-alert-message" style="margin-top: 10px; opacity: 0.8;"></p>
            <div class="modal-actions" style="justify-content: center;">
                <button id="custom-alert-ok" class="btn-confirm" style="width: 100%;">OK</button>
            </div>
        </div>
    </div>

    <!-- Generic Custom Confirm Modal -->
    <div id="custom-confirm-modal" class="custom-modal-overlay hidden" style="z-index: 2000;">
        <div class="custom-modal-box">
            <h3 id="custom-confirm-title">Confirmation</h3>
            <p id="custom-confirm-message" style="margin-top: 10px; opacity: 0.8;"></p>
            <div class="modal-actions">
                <button id="custom-confirm-yes" class="btn-confirm">Oui</button>
                <button id="custom-confirm-no" class="btn-cancel">Non</button>
            </div>
        </div>
    </div>

    <!-- End Game Recap Modal -->
    <div id="end-game-modal" class="custom-modal-overlay hidden" style="z-index: 3000;">
        <div class="custom-modal-box" style="max-width: 500px;">
            <h3>Fin de la partie !</h3>
            <div id="final-scoreboard" style="margin: 20px 0; max-height: 300px; overflow-y: auto;">
                <!-- Scores will be injected here -->
            </div>
            
            <div id="host-actions" class="hidden">
                <p style="margin-bottom: 10px; font-size: 0.9rem; opacity: 0.8;">Configurer la prochaine partie :</p>
                <div class="slider-container" style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <input type="range" id="rounds-slider-replay" min="1" max="21" value="21" class="lobby-slider" style="flex: 1;">
                    <span id="rounds-value-replay" class="slider-value" style="font-weight: bold; min-width: 30px; text-align: center;">‚àû</span>
                </div>
                <button id="btn-replay-game" class="btn-confirm" style="width: 100%;">Rejouer avec ces param√®tres</button>
            </div>
            
            <div id="client-waiting-msg" class="hidden">
                <p>En attente de l'h√¥te...</p>
            </div>

            <button id="btn-leave-final" class="btn-cancel" style="margin-top: 10px; width: 100%;">Quitter le salon</button>
        </div>
    </div>

    <!-- In-Game Room Info (Private Only) - REMOVED, MOVED TO SIDEBAR -->
    <!-- <div id="room-info-bar" class="hidden"> ... </div> -->

    <!-- LOBBY MULTIJOUEUR -->
    <div id="lobby-overlay" class="hidden">
        <!-- Bouton Retour Lobby -->
        <button id="btn-lobby-back" class="lobby-back-btn">Retour</button>
        
        <div id="lobby-content" style="display: flex; flex-direction: column; gap: 20px; align-items: center; width: 100%; max-width: 400px;">
            
            <!-- Box 1: Identity -->
            <div class="lobby-box" style="width: 100%;">
                <h2>Ton Profil</h2>
                
                <!-- Avatar Carousel -->
                <div class="avatar-selector">
                    <button id="btn-prev-avatar" class="avatar-nav-btn">‚Äπ</button>
                    <div class="avatar-preview-container">
                        <img id="avatar-preview" src="assets/1.gif" alt="Avatar">
                    </div>
                    <button id="btn-next-avatar" class="avatar-nav-btn">‚Ä∫</button>
                </div>

                <div style="width: 100%; margin-top: 10px;">
                    <input type="text" id="player-pseudo" class="lobby-input" placeholder="COOLKID67" maxlength="12">
                </div>
            </div>

            <!-- Box 2: Actions Wrapper -->
            <div id="lobby-start" style="width: 100%; display: flex; flex-direction: column; gap: 20px;">
                
                <!-- Create Game Box -->
                <div class="lobby-box" style="width: 100%;">
                    <h2>Cr√©er une partie</h2>
                    
                    <!-- Game Mode Selector -->
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div class="game-mode-selector" style="margin: 0; flex: 1;">
                            <div class="mode-option selected" data-mode="preums">Premier</div>
                            <div class="mode-option" data-mode="libre">Libre</div>
                            <div class="mode-option" data-mode="temps">Chrono</div>
                        </div>
                        <button id="helpModesBtn" class="help-modes-btn" title="Aide sur les modes">?</button>
                    </div>

                    <!-- Chrono Settings (Hidden by default) -->
                    <div id="chrono-settings" class="hidden" style="margin-bottom: 15px; width: 100%;">
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Temps par ligne (sec) :</label>
                        <input type="number" id="chrono-duration" class="lobby-input" value="30" min="5" max="120" step="1" onkeypress="return event.charCode >= 48 && event.charCode <= 57" style="text-align: center;">
                    </div>

                    <!-- Rounds Settings -->
                    <div id="rounds-settings" style="margin-bottom: 15px; width: 100%;">
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Nombre de manches :</label>
                        <div class="slider-container" style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="rounds-slider" min="1" max="21" value="21" class="lobby-slider" style="flex: 1;">
                            <span id="rounds-value" class="slider-value" style="font-weight: bold; min-width: 30px; text-align: center;">‚àû</span>
                        </div>
                    </div>

                    <button id="btn-create-game" class="lobby-btn">Nouvelle Salle</button>
                </div>

                <!-- Join Game Box -->
                <div class="lobby-box" style="width: 100%;">
                    <h2>Rejoindre une partie</h2>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="lobby-code-input" class="lobby-input" style="margin: 0; flex: 1;" placeholder="ABCD" maxlength="4">
                        <button id="btn-join-game" class="lobby-btn" style="margin: 0; width: auto; min-width: 100px;">Go</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="lobby-box hidden" id="lobby-waiting">
            <h2>Salle d'attente</h2>
            <div style="font-size: 2rem; letter-spacing: 5px; margin: 20px 0; font-weight: bold;" id="display-room-code">----</div>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
                <button id="btn-share-link" class="lobby-btn" style="background: var(--present); font-size: 0.9rem; flex: 2; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                    Lien
                </button>
                <button id="btn-copy-code" class="lobby-btn" style="background: var(--key-bg); font-size: 0.9rem; flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    Code
                </button>
            </div>

            <button id="btn-invite-friend-lobby" class="lobby-btn" style="margin-bottom: 15px; background: var(--present); width: 100%;">Inviter un ami</button>

            <p>Partage ce code avec tes amis</p>
            <div id="players-list" style="margin: 20px 0; text-align: left;">
                <!-- Liste des joueurs -->
            </div>
            <button id="btn-start-game" class="lobby-btn hidden">Lancer la partie</button>
            <p id="waiting-message" class="hidden">En attente du chef de salle...</p>
        </div>
    </div>

    <button id="btn-leave-game" class="back-btn hidden">Retour</button>
    <button id="btn-toggle-sidebar" class="sidebar-toggle hidden">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
    </button>
    <button id="btn-toggle-opponents" class="sidebar-toggle hidden" style="left: 150px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
    </button>
    
    <!-- Chat Toggle Button -->
    <button id="btn-toggle-chat" class="sidebar-toggle hidden">
        <div id="chat-notification-dot" class="hidden"></div>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </button>

    <button id="helpBtn" class="help-btn">?</button>
    <button id="themeToggle" class="theme-switch">Th√®me</button>

    <!-- RULES MODAL -->
    <div id="rules-modal" class="rules-modal-overlay hidden">
        <div class="rules-modal-content">
            <button id="close-rules" class="rules-close-btn">√ó</button>
            <h2 style="margin-bottom: 20px; font-size: 1.5rem;">Comment jouer ?</h2>
            
            <div class="rules-section">
                <p style="margin-bottom: 20px; line-height: 1.6;">Devinez le mot en <strong>6 essais maximum</strong>. Apr√®s chaque tentative, les tuiles changent de couleur pour vous guider.</p>
            </div>

            <div class="rules-section">
                <div class="rule-example">
                    <div class="example-row">
                        <div class="example-tile correct">P</div>
                        <div class="example-tile">L</div>
                        <div class="example-tile">A</div>
                        <div class="example-tile">G</div>
                        <div class="example-tile">E</div>
                    </div>
                    <p>La lettre <strong>P</strong> est dans le mot et bien plac√©e</p>
                </div>

                <div class="rule-example">
                    <div class="example-row">
                        <div class="example-tile">V</div>
                        <div class="example-tile present">O</div>
                        <div class="example-tile">I</div>
                        <div class="example-tile">L</div>
                        <div class="example-tile">E</div>
                    </div>
                    <p>La lettre <strong>O</strong> est dans le mot mais mal plac√©e</p>
                </div>

        
                <div class="rule-example">
                    <div class="example-row">
                        <div class="example-tile start-tile">R</div>
                        <div class="example-tile">A</div>
                        <div class="example-tile">D</div>
                        <div class="example-tile">I</div>
                        <div class="example-tile">S</div>
                    </div>
                    <p>La premi√®re lettre est toujours r√©v√©l√©e pour vous aider</p>
                </div>
            </div>
        </div>
    </div>

    <!-- INVITE MODAL -->
    <div id="invite-modal" class="rules-modal-overlay hidden" style="z-index: 3000;">
        <div class="rules-modal-content" style="max-width: 400px;">
            <button id="close-invite" class="rules-close-btn">√ó</button>
            <h2 style="margin-bottom: 20px; font-size: 1.5rem;">Inviter un ami</h2>
            
            <div class="rules-section" style="text-align: center;">
                <div style="text-align: left;">
                    <p style="margin-bottom: 10px; font-weight: bold;">Tes Amis</p>
                    <div id="invite-friends-list" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--tile-border); border-radius: 8px; padding: 10px; min-height: 100px;">
                        <p style="text-align: center; opacity: 0.6; font-size: 0.9rem; margin-top: 30px;">Connecte-toi pour voir tes amis</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODES HELP MODAL -->
    <div id="modes-modal" class="rules-modal-overlay hidden">
        <div class="rules-modal-content">
            <button id="close-modes" class="rules-close-btn">√ó</button>
            <h2 style="margin-bottom: 25px; font-size: 1.5rem;">Modes de jeu</h2>
            
            <div class="rules-section">
                <h3 style="display: flex; align-items: center; gap: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                        <path d="M4 22h16"></path>
                        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                    </svg>
                    Premier
                </h3>
                <p style="line-height: 1.6;">
                    Le <strong>premier joueur</strong> √† trouver le mot gagne la manche.
                </p>
            </div>

            <div class="rules-section">
                <h3 style="display: flex; align-items: center; gap: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.3" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10 11c-1.657 0-3 1.343-3 3s1.343 3 3 3c1.226 0 2.318-.738 3-1.707C12.318 11.738 11.226 11 10 11Z"></path>
                        <path d="M18 11c-1.226 0-2.318.738-3 1.707C15.682 16.262 16.774 17 18 17c1.657 0 3-1.343 3-3s-1.343-3-3-3Z"></path>
                    </svg>
                    Libre
                </h3>
                <p style="line-height: 1.6;">
                    Chacun joue √† son rythme. Le joueur avec le <strong>meilleur score</strong> (moins d'essais) gagne.
                </p>
            </div>

            <div class="rules-section">
                <h3 style="display: flex; align-items: center; gap: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    Chrono
                </h3>
                <p style="line-height: 1.6; margin-bottom: 12px;">
                    Quand un joueur <strong>valide une ligne</strong>, un chrono se d√©clenche pour les autres joueurs. Le premier √† trouver le mot gagne !
                </p>
                <div class="rule-example">
                    <div class="example-row" style="justify-content: flex-start;">
                        <div class="example-tile correct">M</div>
                        <div class="example-tile present">O</div>
                        <div class="example-tile correct">T</div>
                        <div class="example-tile absent">E</div>
                        <div class="example-tile absent">L</div>
                        <span style="margin-left: 10px; font-weight: 600; color: var(--present); display: flex; align-items: center; gap: 5px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            30s
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CHAT PANEL -->
    <div id="chat-panel" class="hidden">
        <div class="chat-header">
            <span>Tchat de la salle</span>
            <button id="btn-close-chat">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        
        <div id="chat-messages">
            <div class="chat-system-msg">Bienvenue dans le tchat !</div>
        </div>

        <!-- Moved Reactions Here -->
        <div class="chat-reactions-bar">
            <button class="reaction-btn" onclick="sendReaction('happy')" title="Content">
                <svg viewBox="0 0 32 32" width="24" height="24"><circle cx="16" cy="16" r="14" fill="#FFD93D"/><circle cx="10" cy="14" r="2" fill="#5C3D2E"/><circle cx="22" cy="14" r="2" fill="#5C3D2E"/><path d="M10 20 Q16 26 22 20" stroke="#5C3D2E" stroke-width="2" fill="none" stroke-linecap="round"/><circle cx="7" cy="18" r="1.5" fill="#FF8B8B" opacity="0.6"/><circle cx="25" cy="18" r="1.5" fill="#FF8B8B" opacity="0.6"/></svg>
            </button>
            <button class="reaction-btn" onclick="sendReaction('sad')" title="Triste">
                <svg viewBox="0 0 32 32" width="24" height="24"><circle cx="16" cy="16" r="14" fill="#89CFF0"/><path d="M9 14 Q11 12 13 14" stroke="#1A5F7A" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M19 14 Q21 12 23 14" stroke="#1A5F7A" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M12 22 Q16 18 20 22" stroke="#1A5F7A" stroke-width="2" fill="none" stroke-linecap="round"/><circle cx="23" cy="18" r="1.5" fill="#4FA3D1"/></svg>
            </button>
            <button class="reaction-btn" onclick="sendReaction('angry')" title="√ânerv√©">
                <svg viewBox="0 0 32 32" width="24" height="24"><circle cx="16" cy="16" r="14" fill="#FF6B6B"/><path d="M9 13 L13 15" stroke="#8B0000" stroke-width="2" stroke-linecap="round"/><path d="M23 13 L19 15" stroke="#8B0000" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="17" r="1.5" fill="#8B0000"/><circle cx="21" cy="17" r="1.5" fill="#8B0000"/><path d="M13 22 H19" stroke="#8B0000" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
            <button class="reaction-btn" onclick="sendReaction('surprised')" title="Surpris">
                <svg viewBox="0 0 32 32" width="24" height="24"><circle cx="16" cy="16" r="14" fill="#C780FA"/><circle cx="10" cy="14" r="2" fill="#4A148C"/><circle cx="22" cy="14" r="2" fill="#4A148C"/><ellipse cx="16" cy="22" rx="3" ry="4" fill="#4A148C"/><path d="M8 10 Q10 8 12 10" stroke="#4A148C" stroke-width="1" fill="none"/><path d="M20 10 Q22 8 24 10" stroke="#4A148C" stroke-width="1" fill="none"/></svg>
            </button>
        </div>

        <div class="chat-input-area">
            <input type="text" id="chat-input-field" placeholder="Message..." maxlength="100">
            <button id="btn-send-chat">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
    </div>



    <!-- In-Game Sidebar (Room Info + Players) -->
    <div id="sidebar-overlay"></div>
    <div id="ingame-sidebar" class="hidden">
        <div class="sidebar-header">
            <div class="room-code-box">
                <span style="font-size: 0.7rem; opacity: 0.7;">CODE</span>
                <span id="sidebar-room-code" style="font-weight: bold; letter-spacing: 2px;">----</span>
            </div>
            <div class="room-mode-box" style="margin-left: 10px; display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; opacity: 0.7;">MODE</span>
                <span id="sidebar-game-mode" style="font-weight: bold; text-transform: uppercase; font-size: 0.8rem;">----</span>
            </div>
            <div class="room-round-box" style="margin-left: 10px; display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; opacity: 0.7;">MANCHE</span>
                <span id="sidebar-round-info" style="font-weight: bold; font-size: 0.8rem;">1 / ‚àû</span>
            </div>
            <div class="sidebar-actions">
                <button id="inviteBtn" class="icon-btn" title="Inviter un ami">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="20" y1="8" x2="20" y2="14"></line>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                </button>
                <button id="sidebar-share-link" class="icon-btn" title="Copier le lien">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                </button>
                <button id="sidebar-copy-code" class="icon-btn" title="Copier le code">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </button>
            </div>
        </div>
        <div id="ingame-players-content">
            <!-- Populated by JS -->
        </div>
        
        <!-- Host Actions -->
        <div id="sidebar-host-actions" style="margin-top: auto; padding-top: 10px; border-top: 1px solid var(--tile-border);">
            <button id="btn-force-finish" class="sidebar-btn hidden" style="width: 100%; background: var(--absent); color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                Finir la partie
            </button>
        </div>
    </div>

    <div class="game-container" style="position: relative;">
        <!-- Zone des adversaires -->
        <div id="opponents-container"></div>
        <button id="btn-close-preview" class="mobile-preview-close hidden">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>

        <!-- Score Legend (Left Side) -->
        <div id="score-legend-container" style="position: absolute; left: -160px; top: 50%; transform: translateY(-50%); width: 140px; background: var(--tile-bg); padding: 10px; border-radius: 8px; border: 1px solid var(--tile-border); display: flex; flex-direction: column; gap: 8px; font-size: 0.8rem;">
            <div style="font-weight: bold; text-align: center; margin-bottom: 5px; border-bottom: 1px solid var(--tile-border); padding-bottom: 5px;">Points</div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="width: 15px; height: 15px; background: var(--present); display: inline-block; border-radius: 3px;"></span>
                <span>+5</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="width: 15px; height: 15px; background: var(--correct); display: inline-block; border-radius: 3px;"></span>
                <span>+10</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 1.2em;">‚è±Ô∏è</span>
                <span>√âCO +30</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 1.2em;">üèÜ</span>
                <span>TROUV√â +50</span>
            </div>
        </div>

        <div id="message-container"></div>

        <div class="grid" id="grid"></div>

        <div class="keyboard" id="keyboard">
            <div class="key-row">
                <button class="key" data-key="A">A</button>
                <button class="key" data-key="Z">Z</button>
                <button class="key" data-key="E">E</button>
                <button class="key" data-key="R">R</button>
                <button class="key" data-key="T">T</button>
                <button class="key" data-key="Y">Y</button>
                <button class="key" data-key="U">U</button>
                <button class="key" data-key="I">I</button>
                <button class="key" data-key="O">O</button>
                <button class="key" data-key="P">P</button>
            </div>
            <div class="key-row">
                <button class="key" data-key="Q">Q</button>
                <button class="key" data-key="S">S</button>
                <button class="key" data-key="D">D</button>
                <button class="key" data-key="F">F</button>
                <button class="key" data-key="G">G</button>
                <button class="key" data-key="H">H</button>
                <button class="key" data-key="J">J</button>
                <button class="key" data-key="K">K</button>
                <button class="key" data-key="L">L</button>
                <button class="key" data-key="M">M</button>
            </div>
            <div class="key-row">
                <button class="key large" data-key="Enter">Entr√©e</button>
                <button class="key" data-key="W">W</button>
                <button class="key" data-key="X">X</button>
                <button class="key" data-key="C">C</button>
                <button class="key" data-key="V">V</button>
                <button class="key" data-key="B">B</button>
                <button class="key" data-key="N">N</button>
                <button class="key large" data-key="Backspace">‚å´</button>
            </div>
        </div>
    </div>

    <!-- End Game Modal -->
    <div id="endModal" class="modal hidden">
        <div class="modal-content">
            <h2 id="endTitle">Titre</h2>
            <p id="endMessage">Message</p>
            <div id="wordDisplay" class="word-reveal"></div>
            <div class="modal-actions">
                <button id="shareBtn" class="action-btn share">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    Partager
                </button>
                <button id="restartBtn" class="action-btn restart">Rejouer</button>
            </div>
        </div>
    </div>

    <script src="supabase-client.js"></script>
    <script src="auth.js?v=3"></script>
    <script src="game.js"></script>
    <script src="multiplayer.js"></script>
</body>
</html>
